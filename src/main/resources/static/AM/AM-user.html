<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title></title>
    <link rel="stylesheet" type="text/css" href="../easyui/easyui.css"/>
    <link rel="stylesheet" type="text/css" href="../css/icon.css"/>
    <script src="../js/jquery.min.js" type="text/javascript"
            charset="utf-8"></script>
    <script src="../js/jquery.easyui.min.js" type="text/javascript"
            charset="utf-8"></script>
    <script src="../js/easyui-lang-zh_CN.js" type="text/javascript"
            charset="utf-8"></script>
</head>
<body>

<div>
    <!--搜索框-->
    <input class="easyui-textbox" name="userName" id="user-name" placeholder="请输入关键字">
    <a id="user-search" class="easyui-linkbutton" iconCls="icon-search">搜索</a>
    <!--创建表格-->
    <div id="datagrid" class="easyui-datagrid" style="width: 100%" ></div>

    <!--添加弹窗-->
    <div class="easyui-dialog" id="dialog" style="width: 300px; height: 300px;"data-options="resizable:true,modal:true,closable:true,closed:true,">
        <form id="addForm" style="padding: 10px;" method="post">
            <div style="margin: 20px;">
                <label>用户名：</label><input type="text" name="userName" id="username"class="easyui-textbox"/>
            </div>
            <div style="margin-left: 30px;">
                <label>密码：</label><input type="text" name="userlogpwd" id="password" class="easyui-textbox"/>
            </div>
        </form>
    </div>
</div>



</body>
<script type="text/javascript">


    var dialog = $('#dialog');
    var form = $('form');

    $(function () {
        dialog.dialog('close');
    });

    $(function () {
        dialog.dialog('close');
        $('#datagrid').datagrid({
            url:'queryAllPanyuUser',//数据来源
            columns:[[
                {field:'',checkbox:true},
                {field:'userId',title:'密码',width:300,align:'center',hidden:true},
                {field:'userName',title:'用户名',width:300,align:'center'},
                {field:'userlogpwd',title:'密码',width:300,align:'center'},
            ]],
            rownumbers:true,//显示行号
            singleSelect:false,//是否单选
            pagination:true,//显示分页栏
            pageList:[10,20,50,100],//每页行数选择列表
            pageSize:10,//出示每页行数
            remoteSort:true,//是否服务器端排序，设成false，才能客户端排序
            //  sortName:'sno',//设置排序列
            // sortOrder:'desc',//排序方式
            //  idField:'id',
            toolbar:[
                {
                    iconCls:'icon-add',
                    text:'添加',
                    handler:function () {
                        dialog.dialog('open');
                    }
                },
                {
                    iconCls:'icon-remove',
                    text:'删除',
                    handler:function () {
                        var id=$("#datagrid").datagrid("getSelections");
                        if(id.length==0)
                        {
                            alert('请选中一条数据！');
                        }
                        else
                        {

                            alert("选中条数="+id.length);
                            $.messager.confirm("确认","确实要删除吗？",function(r){
                                if(r)
                                {
                                    //利用数组，保存选中记录的主键
                                    var snos=[];
                                    for(var i=0;i<id.length;i++)
                                    {
                                        snos[i]=id[i].userId;
                                        console.log("ids:"+snos[i])
                                    }


                                    $.get("deletePanyuUser?ids="+snos,
                                        function(data){
                                            //var msg=eval("("+rtn+")");
                                            console.log("data:"+data);
                                            /* if(data==true)
                                             {*/
                                            $('#datagrid').datagrid('reload');
                                            /*  }*/

                                        });

                                }
                            });


                        }

                    }
                },
            ]
        })
    })
    $(function () {
        dialog.dialog({
            title:'添加用户',
            buttons:[{
                text:'保存',
                iconCls:'icon-save',
                handler:function () {

                    /*var message={*/
                    var  userName=$("#username").val().trim();
                    var userlogpwd=$("#password").val().trim();
                    //console.log("userName:"+userName);
                    // console.log("userlogpwd:"+userlogpwd);
                    /*  };*/

                    if($("#username").val()!=""&&$("#password").val()!="")
                    {
                        $.ajax({
                            type:"post",
                            url:"addPanyuUser",
                            data:{"userName":userName,"userlogpwd":userlogpwd},
                            success:function(){
                                alert("添加成功！");

                                dialog.dialog('close');
                                $("#addForm").form("clear");
                                $('#datagrid').datagrid('reload');
                                $("#username").val("");
                                $("#password").val("");
                            }
                        })


                    }
                    else{alert("请填写完整！");
                        $("#username").val("");
                        $("#password").val("");
                    }

                },
            },
                {
                    text:'取消',
                    iconCls:'icon-remove',
                    handler:function () {
                        dialog.dialog('close');
                    },
                }]
        })

    });



    //点击搜索
    $("#user-search").on("click",function () {
        var  userName=$("#user-name").val().trim();
        console.log("名字:"+userName);
        $("#datagrid").datagrid({url:"queryAllPanyuUser?userName="+userName}).datagrid('load');
    });





</script>
</html>
